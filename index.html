---
layout: map
permalink: /
group: navigation
navid: home
navtitle: Map
navweight: 0
---

<script>
	var map;

	var city_maps = [ // Add the cities since there's no other way of separating normal maps from instanced maps, other than getting event maps and manually adding the cities
		18, // Divinity's Reach
		50, // Lion's Arch
		91, // The Grove
		139, // Rata Sum
		218, // Black Citadel
		326, // Hoelbrak
	];

	var dungeon_maps = [
		33, // Ascalonian Catacombs
		76, // Caudecus's Manor
		68, // Twilight Arbor
		63, // Sorrow's Embrace
		69, // Citadel of Flame
		71, // Honor of the Waves
		81, // Crucible of Eternity
		112 // The Ruined City of Arah
	];


	function unproject(coord) {
		return map.unproject(coord, map.getMaxZoom());
	}

	function fixAnchor(className) {
		var $obj = $(className);
		var width = $obj.width();
		var height = $obj.height();
		$obj.css("margin-left", -(width / 2) + "px").css("margin-top", -(height / 2) + "px");
	}

	function addMapBoundary(mapData) {
		var continent_rect = mapData.continent_rect;
		var map_id = mapData.map_id;
		var map_rect = mapData.map_rect;
		var region_id = mapData.region_id;

		var popupTitle = mapData.map_name + " (" + mapData.region_name + ") - " + map_id;
		var rectangleClassName = "map-boundary-" + map_id + " region-boundary-" + region_id;
		var labelClassName = "map-label-" + map_id + " map-label-region-" + region_id;
		switch (mapData.map_type) {
			case "city":
				popupTitle += " - City";
				rectangleClassName += " region-boundary-map-city";
				labelClassName += " map-label-city";
				break;
			case "dungeon":
				popupTitle += " - Dungeon";
				rectangleClassName += " region-boundary-map-dungeon";
				labelClassName += " map-label-dungeon";
				break;
			default:
				rectangleClassName += " region-boundary-map-default";
				labelClassName += " map-label-default";
				break;
		}

		var popup = "<b>" + popupTitle + "</b><br /><br />" +
			"Continent coords: from (" + continent_rect[0][0] + "," + continent_rect[0][1] + ") to (" + continent_rect[1][0] + "," + continent_rect[1][1] + ")<br />" +
			"Continent size: " + (continent_rect[1][0] - continent_rect[0][0]) + " x " + (continent_rect[1][1] - continent_rect[0][1]) + "<br />" +
			"Map size: " + (map_rect[1][0] - map_rect[0][0]) + " x " + (map_rect[1][1] - map_rect[0][1]);

		var continent_rect2 = [unproject(continent_rect[0]), unproject(continent_rect[1])];
		L.rectangle(continent_rect2, { className: rectangleClassName, weight: 1, clickable: true }).addTo(map).bindPopup(popup);

		label_coord = unproject([(continent_rect[0][0] + continent_rect[1][0]) / 2, (continent_rect[0][1] + continent_rect[1][1]) / 2]);
		var label = L.divIcon({ className: labelClassName, html: mapData.map_name, iconSize: null });
		L.marker(label_coord, { icon: label, clickable: true }).addTo(map).bindPopup(popup);

		fixAnchor(".map-label-" + map_id);
	}

	$(function () {
		var southWest, northEast;

		map = L.map("map", {
			minZoom: 2,
			maxZoom: 7,
			crs: L.CRS.Simple,
			background: "#000000"
		});
		map.setView(unproject([16384, 16384]), 3);

		southWest = unproject([0, 32768]);
		northEast = unproject([32768, 0]);

		map.setMaxBounds(new L.LatLngBounds(southWest, northEast));

		L.tileLayer("https://tiles.guildwars2.com/1/1/{z}/{x}/{y}.jpg", {
			minZoom: 0,
			maxZoom: 7,
			continuousWorld: true
		}).addTo(map);

		$.getJSON("https://api.guildwars2.com/v1/map_names.json", function(data_mapnames) {
			var mapnames = data_mapnames;
			$.getJSON("https://api.guildwars2.com/v1/maps.json", function(data_maps) {
				var mapData = data_maps.maps;
				var maps = {};

				for (var i in mapnames) {
					var id = mapnames[i].id;
					if (mapData[id] !== undefined && mapData[id].continent_id == 1) {
						maps[id] = mapData[id];
						maps[id].map_id = id;
						maps[id].map_type = "";
					}
				}
				for (var i in city_maps) {
					var id = city_maps[i];
					maps[id] = mapData[id];
					maps[id].map_id = id;
					maps[id].map_type = "city";
				}
				for (var i in dungeon_maps) {
					var id = dungeon_maps[i];
					maps[id] = mapData[id];
					maps[id].map_id = id;
					maps[id].map_type = "dungeon";
				}

				for (var id in maps) {
					addMapBoundary(maps[id]);
				}
			});
		});

		$.getJSON("https://api.guildwars2.com/v1/map_floor.json?continent_id=1&floor=1", function(data) {
			var regions = data.regions;
			for (var region in regions) {
				var region_id = region;
				region = regions[region_id];

				var label = L.divIcon({ className: "region-label-" + region_id + " region-label", html: region.name, iconSize: null });
				L.marker(unproject(region.label_coord), { icon: label, zIndexOffset: 1000, clickable: false }).addTo(map);

				fixAnchor(".region-label-" + region_id);
			}
		});
	});
</script>
